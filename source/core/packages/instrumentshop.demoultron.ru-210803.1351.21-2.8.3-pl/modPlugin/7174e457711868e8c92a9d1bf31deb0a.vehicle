<?php return array (
  'preserve_keys' => true,
  'update_object' => true,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => '74fccbb2425bb7647e4151b11b4e48a2',
  'package' => 'modx',
  'class' => 'modPlugin',
  'signature' => '7174e457711868e8c92a9d1bf31deb0a',
  'native_key' => 18,
  'object' => '{"id":18,"source":1,"property_preprocess":0,"name":"miniShop2","description":"","editor_type":0,"category":22,"cache_type":0,"plugincode":"\\/** @var modX $modx *\\/\\nswitch ($modx->event->name) {\\n\\n    case \'OnMODXInit\':\\n        \\/\\/ Load extensions\\n        \\/** @var miniShop2 $miniShop2 *\\/\\n        if ($miniShop2 = $modx->getService(\'miniShop2\')) {\\n            $miniShop2->loadMap();\\n        }\\n        break;\\n\\n    case \'OnHandleRequest\':\\n        \\/\\/ Handle ajax requests\\n        $isAjax = !empty($_SERVER[\'HTTP_X_REQUESTED_WITH\']) && $_SERVER[\'HTTP_X_REQUESTED_WITH\'] == \'XMLHttpRequest\';\\n        if (empty($_REQUEST[\'ms2_action\']) || !$isAjax) {\\n            return;\\n        }\\n        \\/** @var miniShop2 $miniShop2 *\\/\\n        if ($miniShop2 = $modx->getService(\'miniShop2\')) {\\n            $response = $miniShop2->handleRequest($_REQUEST[\'ms2_action\'], @$_POST);\\n            @session_write_close();\\n            exit($response);\\n        }\\n        break;\\n\\n    case \'OnManagerPageBeforeRender\':\\n        \\/** @var miniShop2 $miniShop2 *\\/\\n        if ($miniShop2 = $modx->getService(\'miniShop2\')) {\\n            $modx->controller->addLexiconTopic(\'minishop2:default\');\\n            $modx->regClientStartupScript($miniShop2->config[\'jsUrl\'] . \'mgr\\/misc\\/ms2.manager.js\');\\n        }\\n        break;\\n\\n    case \'OnLoadWebDocument\':\\n        \\/\\/ Handle non-ajax requests\\n        if (!empty($_REQUEST[\'ms2_action\'])) {\\n            if ($miniShop2 = $modx->getService(\'miniShop2\')) {\\n                $miniShop2->handleRequest($_REQUEST[\'ms2_action\'], @$_POST);\\n            }\\n        }\\n        \\/\\/ Set product fields as [[*resource]] tags\\n        if ($modx->resource->get(\'class_key\') == \'msProduct\') {\\n            if ($dataMeta = $modx->getFieldMeta(\'msProductData\')) {\\n                unset($dataMeta[\'id\']);\\n                $modx->resource->_fieldMeta = array_merge(\\n                    $modx->resource->_fieldMeta,\\n                    $dataMeta\\n                );\\n            }\\n        }\\n        break;\\n\\n    case \'OnWebPageInit\':\\n        \\/\\/ Set referrer cookie\\n        \\/** @var msCustomerProfile $profile *\\/\\n        $referrerVar = $modx->getOption(\'ms2_referrer_code_var\', null, \'msfrom\', true);\\n        $cookieVar = $modx->getOption(\'ms2_referrer_cookie_var\', null, \'msreferrer\', true);\\n        $cookieTime = $modx->getOption(\'ms2_referrer_time\', null, 86400 * 365, true);\\n\\n        if (!$modx->user->isAuthenticated() && !empty($_REQUEST[$referrerVar])) {\\n            $code = trim($_REQUEST[$referrerVar]);\\n            if ($profile = $modx->getObject(\'msCustomerProfile\', array(\'referrer_code\' => $code))) {\\n                $referrer = $profile->get(\'id\');\\n                setcookie($cookieVar, $referrer, time() + $cookieTime);\\n            }\\n        }\\n        break;\\n\\n    case \'OnUserSave\':\\n        \\/\\/ Save referrer id\\n        if ($mode == modSystemEvent::MODE_NEW) {\\n            \\/** @var modUser $user *\\/\\n            $cookieVar = $modx->getOption(\'ms2_referrer_cookie_var\', null, \'msreferrer\', true);\\n            $cookieTime = $modx->getOption(\'ms2_referrer_time\', null, 86400 * 365, true);\\n            if ($modx->context->key != \'mgr\' && !empty($_COOKIE[$cookieVar])) {\\n                if ($profile = $modx->getObject(\'msCustomerProfile\', array(\'id\' => $user->get(\'id\')))) {\\n                    if (!$profile->get(\'referrer_id\') && $_COOKIE[$cookieVar] != $user->get(\'id\')) {\\n                        $profile->set(\'referrer_id\', (int)$_COOKIE[$cookieVar]);\\n                        $profile->save();\\n                    }\\n                }\\n                setcookie($cookieVar, \'\', time() - $cookieTime);\\n            }\\n        }\\n        break;\\n\\n    case \'msOnChangeOrderStatus\':\\n        \\/\\/ Update customer stat\\n        if (empty($status) || $status != 2) {\\n            return;\\n        }\\n\\n        \\/** @var modUser $user *\\/\\n        if ($user = $order->getOne(\'User\')) {\\n            $q = $modx->newQuery(\'msOrder\', array(\'type\' => 0));\\n            $q->innerJoin(\'modUser\', \'modUser\', array(\'modUser.id = msOrder.user_id\'));\\n            $q->innerJoin(\'msOrderLog\', \'msOrderLog\', array(\\n                \'msOrderLog.order_id = msOrder.id\',\\n                \'msOrderLog.action\' => \'status\',\\n                \'msOrderLog.entry\' => $status,\\n            ));\\n            $q->where(array(\'msOrder.user_id\' => $user->get(\'id\')));\\n            $q->groupby(\'msOrder.user_id\');\\n            $q->select(\'SUM(msOrder.cost)\');\\n            if ($q->prepare() && $q->stmt->execute()) {\\n                $spent = $q->stmt->fetchColumn();\\n                \\/** @var msCustomerProfile $profile *\\/\\n                if ($profile = $modx->getObject(\'msCustomerProfile\', array(\'id\' => $user->get(\'id\')))) {\\n                    $profile->set(\'spent\', $spent);\\n                    $profile->save();\\n                }\\n            }\\n        }\\n        break;\\n}","locked":0,"properties":null,"disabled":0,"moduleguid":"","static":0,"static_file":"core\\/components\\/minishop2\\/elements\\/plugins\\/plugin.minishop2.php","content":"\\/** @var modX $modx *\\/\\nswitch ($modx->event->name) {\\n\\n    case \'OnMODXInit\':\\n        \\/\\/ Load extensions\\n        \\/** @var miniShop2 $miniShop2 *\\/\\n        if ($miniShop2 = $modx->getService(\'miniShop2\')) {\\n            $miniShop2->loadMap();\\n        }\\n        break;\\n\\n    case \'OnHandleRequest\':\\n        \\/\\/ Handle ajax requests\\n        $isAjax = !empty($_SERVER[\'HTTP_X_REQUESTED_WITH\']) && $_SERVER[\'HTTP_X_REQUESTED_WITH\'] == \'XMLHttpRequest\';\\n        if (empty($_REQUEST[\'ms2_action\']) || !$isAjax) {\\n            return;\\n        }\\n        \\/** @var miniShop2 $miniShop2 *\\/\\n        if ($miniShop2 = $modx->getService(\'miniShop2\')) {\\n            $response = $miniShop2->handleRequest($_REQUEST[\'ms2_action\'], @$_POST);\\n            @session_write_close();\\n            exit($response);\\n        }\\n        break;\\n\\n    case \'OnManagerPageBeforeRender\':\\n        \\/** @var miniShop2 $miniShop2 *\\/\\n        if ($miniShop2 = $modx->getService(\'miniShop2\')) {\\n            $modx->controller->addLexiconTopic(\'minishop2:default\');\\n            $modx->regClientStartupScript($miniShop2->config[\'jsUrl\'] . \'mgr\\/misc\\/ms2.manager.js\');\\n        }\\n        break;\\n\\n    case \'OnLoadWebDocument\':\\n        \\/\\/ Handle non-ajax requests\\n        if (!empty($_REQUEST[\'ms2_action\'])) {\\n            if ($miniShop2 = $modx->getService(\'miniShop2\')) {\\n                $miniShop2->handleRequest($_REQUEST[\'ms2_action\'], @$_POST);\\n            }\\n        }\\n        \\/\\/ Set product fields as [[*resource]] tags\\n        if ($modx->resource->get(\'class_key\') == \'msProduct\') {\\n            if ($dataMeta = $modx->getFieldMeta(\'msProductData\')) {\\n                unset($dataMeta[\'id\']);\\n                $modx->resource->_fieldMeta = array_merge(\\n                    $modx->resource->_fieldMeta,\\n                    $dataMeta\\n                );\\n            }\\n        }\\n        break;\\n\\n    case \'OnWebPageInit\':\\n        \\/\\/ Set referrer cookie\\n        \\/** @var msCustomerProfile $profile *\\/\\n        $referrerVar = $modx->getOption(\'ms2_referrer_code_var\', null, \'msfrom\', true);\\n        $cookieVar = $modx->getOption(\'ms2_referrer_cookie_var\', null, \'msreferrer\', true);\\n        $cookieTime = $modx->getOption(\'ms2_referrer_time\', null, 86400 * 365, true);\\n\\n        if (!$modx->user->isAuthenticated() && !empty($_REQUEST[$referrerVar])) {\\n            $code = trim($_REQUEST[$referrerVar]);\\n            if ($profile = $modx->getObject(\'msCustomerProfile\', array(\'referrer_code\' => $code))) {\\n                $referrer = $profile->get(\'id\');\\n                setcookie($cookieVar, $referrer, time() + $cookieTime);\\n            }\\n        }\\n        break;\\n\\n    case \'OnUserSave\':\\n        \\/\\/ Save referrer id\\n        if ($mode == modSystemEvent::MODE_NEW) {\\n            \\/** @var modUser $user *\\/\\n            $cookieVar = $modx->getOption(\'ms2_referrer_cookie_var\', null, \'msreferrer\', true);\\n            $cookieTime = $modx->getOption(\'ms2_referrer_time\', null, 86400 * 365, true);\\n            if ($modx->context->key != \'mgr\' && !empty($_COOKIE[$cookieVar])) {\\n                if ($profile = $modx->getObject(\'msCustomerProfile\', array(\'id\' => $user->get(\'id\')))) {\\n                    if (!$profile->get(\'referrer_id\') && $_COOKIE[$cookieVar] != $user->get(\'id\')) {\\n                        $profile->set(\'referrer_id\', (int)$_COOKIE[$cookieVar]);\\n                        $profile->save();\\n                    }\\n                }\\n                setcookie($cookieVar, \'\', time() - $cookieTime);\\n            }\\n        }\\n        break;\\n\\n    case \'msOnChangeOrderStatus\':\\n        \\/\\/ Update customer stat\\n        if (empty($status) || $status != 2) {\\n            return;\\n        }\\n\\n        \\/** @var modUser $user *\\/\\n        if ($user = $order->getOne(\'User\')) {\\n            $q = $modx->newQuery(\'msOrder\', array(\'type\' => 0));\\n            $q->innerJoin(\'modUser\', \'modUser\', array(\'modUser.id = msOrder.user_id\'));\\n            $q->innerJoin(\'msOrderLog\', \'msOrderLog\', array(\\n                \'msOrderLog.order_id = msOrder.id\',\\n                \'msOrderLog.action\' => \'status\',\\n                \'msOrderLog.entry\' => $status,\\n            ));\\n            $q->where(array(\'msOrder.user_id\' => $user->get(\'id\')));\\n            $q->groupby(\'msOrder.user_id\');\\n            $q->select(\'SUM(msOrder.cost)\');\\n            if ($q->prepare() && $q->stmt->execute()) {\\n                $spent = $q->stmt->fetchColumn();\\n                \\/** @var msCustomerProfile $profile *\\/\\n                if ($profile = $modx->getObject(\'msCustomerProfile\', array(\'id\' => $user->get(\'id\')))) {\\n                    $profile->set(\'spent\', $spent);\\n                    $profile->save();\\n                }\\n            }\\n        }\\n        break;\\n}"}',
);