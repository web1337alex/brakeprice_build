<?php return array (
  'preserve_keys' => true,
  'update_object' => true,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => '0aab66f605331c4add806a2ae7d445b6',
  'package' => 'modx',
  'class' => 'modSnippet',
  'signature' => '4c1bf19009789e0523622e7e911b5cba',
  'native_key' => 57,
  'object' => '{"id":57,"source":1,"property_preprocess":0,"name":"pdoSitemap","description":"","editor_type":0,"category":12,"cache_type":0,"snippet":"\\/** @var array $scriptProperties *\\/\\n\\/** @var pdoFetch $pdoFetch *\\/\\n$fqn = $modx->getOption(\'pdoFetch.class\', null, \'pdotools.pdofetch\', true);\\n$path = $modx->getOption(\'pdofetch_class_path\', null, MODX_CORE_PATH . \'components\\/pdotools\\/model\\/\', true);\\nif ($pdoClass = $modx->loadClass($fqn, $path, false, true)) {\\n    $pdoFetch = new $pdoClass($modx, $scriptProperties);\\n} else {\\n    return false;\\n}\\n$pdoFetch->addTime(\'pdoTools loaded\');\\n\\n\\/\\/ Default variables\\nif (empty($tpl)) {\\n    $tpl = \\"@INLINE \\\\n<url>\\\\n\\\\t<loc>[[+url]]<\\/loc>\\\\n\\\\t<lastmod>[[+date]]<\\/lastmod>\\\\n\\\\t<changefreq>[[+update]]<\\/changefreq>\\\\n\\\\t<priority>[[+priority]]<\\/priority>\\\\n<\\/url>\\";\\n}\\nif (empty($tplWrapper)) {\\n    $tplWrapper = \\"@INLINE <?xml version=\\\\\\"1.0\\\\\\" encoding=\\\\\\"[[++modx_charset]]\\\\\\"?>\\\\n<urlset xmlns=\\\\\\"[[+schema]]\\\\\\">\\\\n[[+output]]\\\\n<\\/urlset>\\";\\n}\\nif (empty($sitemapSchema)) {\\n    $sitemapSchema = \'http:\\/\\/www.sitemaps.org\\/schemas\\/sitemap\\/0.9\';\\n}\\nif (empty($outputSeparator)) {\\n    $outputSeparator = \\"\\\\n\\";\\n}\\nif (empty($cacheKey)) {\\n    $scriptProperties[\'cacheKey\'] = \'sitemap\\/\' . substr(md5(json_encode($scriptProperties)), 0, 6);\\n}\\n\\n\\/\\/ Convert parameters from GoogleSiteMap if exists\\nif (!empty($itemTpl)) {\\n    $tpl = $itemTpl;\\n}\\nif (!empty($containerTpl)) {\\n    $tplWrapper = $containerTpl;\\n}\\nif (!empty($allowedtemplates)) {\\n    $scriptProperties[\'templates\'] = $allowedtemplates;\\n}\\nif (!empty($maxDepth)) {\\n    $scriptProperties[\'depth\'] = $maxDepth;\\n}\\nif (isset($hideDeleted)) {\\n    $scriptProperties[\'showDeleted\'] = !$hideDeleted;\\n}\\nif (isset($published)) {\\n    $scriptProperties[\'showUnpublished\'] = !$published;\\n}\\nif (isset($searchable)) {\\n    $scriptProperties[\'showUnsearchable\'] = !$searchable;\\n}\\nif (!empty($googleSchema)) {\\n    $sitemapSchema = $googleSchema;\\n}\\nif (!empty($excludeResources)) {\\n    $tmp = array_map(\'trim\', explode(\',\', $excludeResources));\\n    foreach ($tmp as $v) {\\n        if (!empty($scriptProperties[\'resources\'])) {\\n            $scriptProperties[\'resources\'] .= \',-\' . $v;\\n        } else {\\n            $scriptProperties[\'resources\'] = \'-\' . $v;\\n        }\\n    }\\n}\\nif (!empty($excludeChildrenOf)) {\\n    $tmp = array_map(\'trim\', explode(\',\', $excludeChildrenOf));\\n    foreach ($tmp as $v) {\\n        if (!empty($scriptProperties[\'parents\'])) {\\n            $scriptProperties[\'parents\'] .= \',-\' . $v;\\n        } else {\\n            $scriptProperties[\'parents\'] = \'-\' . $v;\\n        }\\n    }\\n}\\nif (!empty($startId)) {\\n    if (!empty($scriptProperties[\'parents\'])) {\\n        $scriptProperties[\'parents\'] .= \',\' . $startId;\\n    } else {\\n        $scriptProperties[\'parents\'] = $startId;\\n    }\\n}\\nif (!empty($sortBy)) {\\n    $scriptProperties[\'sortby\'] = $sortBy;\\n}\\nif (!empty($sortDir)) {\\n    $scriptProperties[\'sortdir\'] = $sortDir;\\n}\\nif (!empty($priorityTV)) {\\n    if (!empty($scriptProperties[\'includeTVs\'])) {\\n        $scriptProperties[\'includeTVs\'] .= \',\' . $priorityTV;\\n    } else {\\n        $scriptProperties[\'includeTVs\'] = $priorityTV;\\n    }\\n}\\nif (!empty($itemSeparator)) {\\n    $outputSeparator = $itemSeparator;\\n}\\n\\/\\/---\\n\\n\\n$class = \'modResource\';\\n$where = array();\\nif (empty($showHidden)) {\\n    $where[] = array(\\n        $class . \'.hidemenu\' => 0,\\n        \'OR:\' . $class . \'.class_key:IN\' => array(\'Ticket\', \'Article\'),\\n    );\\n}\\nif (empty($context)) {\\n    $scriptProperties[\'context\'] = $modx->context->key;\\n}\\n\\n$select = array($class => \'id,editedon,createdon,context_key,class_key,uri\');\\nif (!empty($useWeblinkUrl)) {\\n    $select[$class] .= \',content\';\\n}\\n\\/\\/ Add custom parameters\\nforeach (array(\'where\', \'select\') as $v) {\\n    if (!empty($scriptProperties[$v])) {\\n        $tmp = $scriptProperties[$v];\\n        if (!is_array($tmp)) {\\n            $tmp = json_decode($tmp, true);\\n        }\\n        if (is_array($tmp)) {\\n            $$v = array_merge($$v, $tmp);\\n        }\\n    }\\n    unset($scriptProperties[$v]);\\n}\\n$pdoFetch->addTime(\'Conditions prepared\');\\n\\n\\/\\/ Default parameters\\n$default = array(\\n    \'class\' => $class,\\n    \'where\' => json_encode($where),\\n    \'select\' => json_encode($select),\\n    \'sortby\' => \\"{$class}.parent ASC, {$class}.menuindex\\",\\n    \'sortdir\' => \'ASC\',\\n    \'return\' => \'data\',\\n    \'scheme\' => \'full\',\\n    \'limit\' => 0,\\n);\\n\\/\\/ Merge all properties and run!\\n$pdoFetch->addTime(\'Query parameters ready\');\\n$pdoFetch->setConfig(array_merge($default, $scriptProperties), false);\\n\\nif (!empty($cache)) {\\n    $data = $pdoFetch->getCache($scriptProperties);\\n}\\nif (empty($data)) {\\n    $now = time();\\n    $data = $urls = array();\\n    $rows = $pdoFetch->run();\\n    foreach ($rows as $row) {\\n        if (!empty($useWeblinkUrl) && $row[\'class_key\'] == \'modWebLink\') {\\n            $row[\'url\'] = is_numeric(trim($row[\'content\'], \'[]~ \'))\\n                ? $pdoFetch->makeUrl(intval(trim($row[\'content\'], \'[]~ \')), $row)\\n                : $row[\'content\'];\\n        } else {\\n            $row[\'url\'] = $pdoFetch->makeUrl($row[\'id\'], $row);\\n        }\\n\\n        $time = !empty($row[\'editedon\'])\\n            ? $row[\'editedon\']\\n            : $row[\'createdon\'];\\n        $row[\'date\'] = date(\'c\', $time);\\n\\n        $datediff = floor(($now - $time) \\/ 86400);\\n        if ($datediff <= 1) {\\n            $row[\'priority\'] = \'1.0\';\\n            $row[\'update\'] = \'daily\';\\n        } elseif (($datediff > 1) && ($datediff <= 7)) {\\n            $row[\'priority\'] = \'0.75\';\\n            $row[\'update\'] = \'weekly\';\\n        } elseif (($datediff > 7) && ($datediff <= 30)) {\\n            $row[\'priority\'] = \'0.50\';\\n            $row[\'update\'] = \'weekly\';\\n        } else {\\n            $row[\'priority\'] = \'0.25\';\\n            $row[\'update\'] = \'monthly\';\\n        }\\n        if (!empty($priorityTV) && !empty($row[$priorityTV])) {\\n            $row[\'priority\'] = $row[$priorityTV];\\n        }\\n\\n        \\/\\/ Fix possible duplicates made by modWebLink\\n        if (!empty($urls[$row[\'url\']])) {\\n            if ($urls[$row[\'url\']] > $row[\'date\']) {\\n                continue;\\n            }\\n        }\\n        $urls[$row[\'url\']] = $row[\'date\'];\\n\\n        \\/\\/ Add item to output\\n        $data[$row[\'url\']] = $pdoFetch->parseChunk($tpl, $row);\\n        if (strpos($data[$row[\'url\']], \'[[\') !== false) {\\n            $modx->parser->processElementTags(\'\', $data[$row[\'url\']], true, true, \'[[\', \']]\', array(), 10);\\n        }\\n    }\\n    $pdoFetch->addTime(\'Rows processed\');\\n    if (!empty($cache)) {\\n        $pdoFetch->setCache($data, $scriptProperties);\\n    }\\n}\\n\\n$output = implode($outputSeparator, $data);\\n$output = $pdoFetch->getChunk($tplWrapper, array(\\n    \'schema\' => $sitemapSchema,\\n    \'output\' => $output,\\n    \'items\' => $output,\\n));\\n$pdoFetch->addTime(\'Rows wrapped\');\\n\\nif ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {\\n    $output .= \'<pre class=\\"pdoSitemapLog\\">\' . print_r($pdoFetch->getTime(), 1) . \'<\\/pre>\';\\n}\\n\\nif (!empty($forceXML)) {\\n    header(\\"Content-Type:text\\/xml\\");\\n    @session_write_close();\\n    exit($output);\\n} else {\\n    return $output;\\n}","locked":0,"properties":"a:24:{s:3:\\"tpl\\";a:7:{s:4:\\"name\\";s:3:\\"tpl\\";s:4:\\"desc\\";s:17:\\"pdotools_prop_tpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:145:\\"@INLINE <url>\\n\\t<loc>[[+url]]<\\/loc>\\n\\t<lastmod>[[+date]]<\\/lastmod>\\n\\t<changefreq>[[+update]]<\\/changefreq>\\n\\t<priority>[[+priority]]<\\/priority>\\n<\\/url>\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"tplWrapper\\";a:7:{s:4:\\"name\\";s:10:\\"tplWrapper\\";s:4:\\"desc\\";s:24:\\"pdotools_prop_tplWrapper\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:110:\\"@INLINE <?xml version=\\"1.0\\" encoding=\\"[[++modx_charset]]\\"?>\\n<urlset xmlns=\\"[[+schema]]\\">\\n[[+output]]\\n<\\/urlset>\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"templates\\";a:7:{s:4:\\"name\\";s:9:\\"templates\\";s:4:\\"desc\\";s:23:\\"pdotools_prop_templates\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"context\\";a:7:{s:4:\\"name\\";s:7:\\"context\\";s:4:\\"desc\\";s:21:\\"pdotools_prop_context\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"depth\\";a:7:{s:4:\\"name\\";s:5:\\"depth\\";s:4:\\"desc\\";s:19:\\"pdotools_prop_depth\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";i:10;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"showDeleted\\";a:7:{s:4:\\"name\\";s:11:\\"showDeleted\\";s:4:\\"desc\\";s:25:\\"pdotools_prop_showDeleted\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"showHidden\\";a:7:{s:4:\\"name\\";s:10:\\"showHidden\\";s:4:\\"desc\\";s:24:\\"pdotools_prop_showHidden\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"sitemapSchema\\";a:7:{s:4:\\"name\\";s:13:\\"sitemapSchema\\";s:4:\\"desc\\";s:27:\\"pdotools_prop_sitemapSchema\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:43:\\"http:\\/\\/www.sitemaps.org\\/schemas\\/sitemap\\/0.9\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"showUnpublished\\";a:7:{s:4:\\"name\\";s:15:\\"showUnpublished\\";s:4:\\"desc\\";s:29:\\"pdotools_prop_showUnpublished\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:16:\\"hideUnsearchable\\";a:7:{s:4:\\"name\\";s:16:\\"hideUnsearchable\\";s:4:\\"desc\\";s:30:\\"pdotools_prop_hideUnsearchable\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"resources\\";a:7:{s:4:\\"name\\";s:9:\\"resources\\";s:4:\\"desc\\";s:23:\\"pdotools_prop_resources\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"parents\\";a:7:{s:4:\\"name\\";s:7:\\"parents\\";s:4:\\"desc\\";s:21:\\"pdotools_prop_parents\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:6:\\"sortby\\";a:7:{s:4:\\"name\\";s:6:\\"sortby\\";s:4:\\"desc\\";s:20:\\"pdotools_prop_sortby\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:9:\\"menuindex\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"sortdir\\";a:7:{s:4:\\"name\\";s:7:\\"sortdir\\";s:4:\\"desc\\";s:21:\\"pdotools_prop_sortdir\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:3:\\"asc\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"where\\";a:7:{s:4:\\"name\\";s:5:\\"where\\";s:4:\\"desc\\";s:19:\\"pdotools_prop_where\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"includeTVs\\";a:7:{s:4:\\"name\\";s:10:\\"includeTVs\\";s:4:\\"desc\\";s:24:\\"pdotools_prop_includeTVs\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"prepareTVs\\";a:7:{s:4:\\"name\\";s:10:\\"prepareTVs\\";s:4:\\"desc\\";s:24:\\"pdotools_prop_prepareTVs\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"processTVs\\";a:7:{s:4:\\"name\\";s:10:\\"processTVs\\";s:4:\\"desc\\";s:24:\\"pdotools_prop_processTVs\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"outputSeparator\\";a:7:{s:4:\\"name\\";s:15:\\"outputSeparator\\";s:4:\\"desc\\";s:29:\\"pdotools_prop_outputSeparator\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:1:\\"\\n\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"forceXML\\";a:7:{s:4:\\"name\\";s:8:\\"forceXML\\";s:4:\\"desc\\";s:22:\\"pdotools_prop_forceXML\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"useWeblinkUrl\\";a:7:{s:4:\\"name\\";s:13:\\"useWeblinkUrl\\";s:4:\\"desc\\";s:27:\\"pdotools_prop_useWeblinkUrl\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"cache\\";a:7:{s:4:\\"name\\";s:5:\\"cache\\";s:4:\\"desc\\";s:19:\\"pdotools_prop_cache\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"cacheKey\\";a:7:{s:4:\\"name\\";s:8:\\"cacheKey\\";s:4:\\"desc\\";s:22:\\"pdotools_prop_cacheKey\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"cacheTime\\";a:7:{s:4:\\"name\\";s:9:\\"cacheTime\\";s:4:\\"desc\\";s:23:\\"pdotools_prop_cacheTime\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";i:600;s:7:\\"lexicon\\";s:19:\\"pdotools:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"core\\/components\\/pdotools\\/elements\\/snippets\\/snippet.pdositemap.php","content":"\\/** @var array $scriptProperties *\\/\\n\\/** @var pdoFetch $pdoFetch *\\/\\n$fqn = $modx->getOption(\'pdoFetch.class\', null, \'pdotools.pdofetch\', true);\\n$path = $modx->getOption(\'pdofetch_class_path\', null, MODX_CORE_PATH . \'components\\/pdotools\\/model\\/\', true);\\nif ($pdoClass = $modx->loadClass($fqn, $path, false, true)) {\\n    $pdoFetch = new $pdoClass($modx, $scriptProperties);\\n} else {\\n    return false;\\n}\\n$pdoFetch->addTime(\'pdoTools loaded\');\\n\\n\\/\\/ Default variables\\nif (empty($tpl)) {\\n    $tpl = \\"@INLINE \\\\n<url>\\\\n\\\\t<loc>[[+url]]<\\/loc>\\\\n\\\\t<lastmod>[[+date]]<\\/lastmod>\\\\n\\\\t<changefreq>[[+update]]<\\/changefreq>\\\\n\\\\t<priority>[[+priority]]<\\/priority>\\\\n<\\/url>\\";\\n}\\nif (empty($tplWrapper)) {\\n    $tplWrapper = \\"@INLINE <?xml version=\\\\\\"1.0\\\\\\" encoding=\\\\\\"[[++modx_charset]]\\\\\\"?>\\\\n<urlset xmlns=\\\\\\"[[+schema]]\\\\\\">\\\\n[[+output]]\\\\n<\\/urlset>\\";\\n}\\nif (empty($sitemapSchema)) {\\n    $sitemapSchema = \'http:\\/\\/www.sitemaps.org\\/schemas\\/sitemap\\/0.9\';\\n}\\nif (empty($outputSeparator)) {\\n    $outputSeparator = \\"\\\\n\\";\\n}\\nif (empty($cacheKey)) {\\n    $scriptProperties[\'cacheKey\'] = \'sitemap\\/\' . substr(md5(json_encode($scriptProperties)), 0, 6);\\n}\\n\\n\\/\\/ Convert parameters from GoogleSiteMap if exists\\nif (!empty($itemTpl)) {\\n    $tpl = $itemTpl;\\n}\\nif (!empty($containerTpl)) {\\n    $tplWrapper = $containerTpl;\\n}\\nif (!empty($allowedtemplates)) {\\n    $scriptProperties[\'templates\'] = $allowedtemplates;\\n}\\nif (!empty($maxDepth)) {\\n    $scriptProperties[\'depth\'] = $maxDepth;\\n}\\nif (isset($hideDeleted)) {\\n    $scriptProperties[\'showDeleted\'] = !$hideDeleted;\\n}\\nif (isset($published)) {\\n    $scriptProperties[\'showUnpublished\'] = !$published;\\n}\\nif (isset($searchable)) {\\n    $scriptProperties[\'showUnsearchable\'] = !$searchable;\\n}\\nif (!empty($googleSchema)) {\\n    $sitemapSchema = $googleSchema;\\n}\\nif (!empty($excludeResources)) {\\n    $tmp = array_map(\'trim\', explode(\',\', $excludeResources));\\n    foreach ($tmp as $v) {\\n        if (!empty($scriptProperties[\'resources\'])) {\\n            $scriptProperties[\'resources\'] .= \',-\' . $v;\\n        } else {\\n            $scriptProperties[\'resources\'] = \'-\' . $v;\\n        }\\n    }\\n}\\nif (!empty($excludeChildrenOf)) {\\n    $tmp = array_map(\'trim\', explode(\',\', $excludeChildrenOf));\\n    foreach ($tmp as $v) {\\n        if (!empty($scriptProperties[\'parents\'])) {\\n            $scriptProperties[\'parents\'] .= \',-\' . $v;\\n        } else {\\n            $scriptProperties[\'parents\'] = \'-\' . $v;\\n        }\\n    }\\n}\\nif (!empty($startId)) {\\n    if (!empty($scriptProperties[\'parents\'])) {\\n        $scriptProperties[\'parents\'] .= \',\' . $startId;\\n    } else {\\n        $scriptProperties[\'parents\'] = $startId;\\n    }\\n}\\nif (!empty($sortBy)) {\\n    $scriptProperties[\'sortby\'] = $sortBy;\\n}\\nif (!empty($sortDir)) {\\n    $scriptProperties[\'sortdir\'] = $sortDir;\\n}\\nif (!empty($priorityTV)) {\\n    if (!empty($scriptProperties[\'includeTVs\'])) {\\n        $scriptProperties[\'includeTVs\'] .= \',\' . $priorityTV;\\n    } else {\\n        $scriptProperties[\'includeTVs\'] = $priorityTV;\\n    }\\n}\\nif (!empty($itemSeparator)) {\\n    $outputSeparator = $itemSeparator;\\n}\\n\\/\\/---\\n\\n\\n$class = \'modResource\';\\n$where = array();\\nif (empty($showHidden)) {\\n    $where[] = array(\\n        $class . \'.hidemenu\' => 0,\\n        \'OR:\' . $class . \'.class_key:IN\' => array(\'Ticket\', \'Article\'),\\n    );\\n}\\nif (empty($context)) {\\n    $scriptProperties[\'context\'] = $modx->context->key;\\n}\\n\\n$select = array($class => \'id,editedon,createdon,context_key,class_key,uri\');\\nif (!empty($useWeblinkUrl)) {\\n    $select[$class] .= \',content\';\\n}\\n\\/\\/ Add custom parameters\\nforeach (array(\'where\', \'select\') as $v) {\\n    if (!empty($scriptProperties[$v])) {\\n        $tmp = $scriptProperties[$v];\\n        if (!is_array($tmp)) {\\n            $tmp = json_decode($tmp, true);\\n        }\\n        if (is_array($tmp)) {\\n            $$v = array_merge($$v, $tmp);\\n        }\\n    }\\n    unset($scriptProperties[$v]);\\n}\\n$pdoFetch->addTime(\'Conditions prepared\');\\n\\n\\/\\/ Default parameters\\n$default = array(\\n    \'class\' => $class,\\n    \'where\' => json_encode($where),\\n    \'select\' => json_encode($select),\\n    \'sortby\' => \\"{$class}.parent ASC, {$class}.menuindex\\",\\n    \'sortdir\' => \'ASC\',\\n    \'return\' => \'data\',\\n    \'scheme\' => \'full\',\\n    \'limit\' => 0,\\n);\\n\\/\\/ Merge all properties and run!\\n$pdoFetch->addTime(\'Query parameters ready\');\\n$pdoFetch->setConfig(array_merge($default, $scriptProperties), false);\\n\\nif (!empty($cache)) {\\n    $data = $pdoFetch->getCache($scriptProperties);\\n}\\nif (empty($data)) {\\n    $now = time();\\n    $data = $urls = array();\\n    $rows = $pdoFetch->run();\\n    foreach ($rows as $row) {\\n        if (!empty($useWeblinkUrl) && $row[\'class_key\'] == \'modWebLink\') {\\n            $row[\'url\'] = is_numeric(trim($row[\'content\'], \'[]~ \'))\\n                ? $pdoFetch->makeUrl(intval(trim($row[\'content\'], \'[]~ \')), $row)\\n                : $row[\'content\'];\\n        } else {\\n            $row[\'url\'] = $pdoFetch->makeUrl($row[\'id\'], $row);\\n        }\\n\\n        $time = !empty($row[\'editedon\'])\\n            ? $row[\'editedon\']\\n            : $row[\'createdon\'];\\n        $row[\'date\'] = date(\'c\', $time);\\n\\n        $datediff = floor(($now - $time) \\/ 86400);\\n        if ($datediff <= 1) {\\n            $row[\'priority\'] = \'1.0\';\\n            $row[\'update\'] = \'daily\';\\n        } elseif (($datediff > 1) && ($datediff <= 7)) {\\n            $row[\'priority\'] = \'0.75\';\\n            $row[\'update\'] = \'weekly\';\\n        } elseif (($datediff > 7) && ($datediff <= 30)) {\\n            $row[\'priority\'] = \'0.50\';\\n            $row[\'update\'] = \'weekly\';\\n        } else {\\n            $row[\'priority\'] = \'0.25\';\\n            $row[\'update\'] = \'monthly\';\\n        }\\n        if (!empty($priorityTV) && !empty($row[$priorityTV])) {\\n            $row[\'priority\'] = $row[$priorityTV];\\n        }\\n\\n        \\/\\/ Fix possible duplicates made by modWebLink\\n        if (!empty($urls[$row[\'url\']])) {\\n            if ($urls[$row[\'url\']] > $row[\'date\']) {\\n                continue;\\n            }\\n        }\\n        $urls[$row[\'url\']] = $row[\'date\'];\\n\\n        \\/\\/ Add item to output\\n        $data[$row[\'url\']] = $pdoFetch->parseChunk($tpl, $row);\\n        if (strpos($data[$row[\'url\']], \'[[\') !== false) {\\n            $modx->parser->processElementTags(\'\', $data[$row[\'url\']], true, true, \'[[\', \']]\', array(), 10);\\n        }\\n    }\\n    $pdoFetch->addTime(\'Rows processed\');\\n    if (!empty($cache)) {\\n        $pdoFetch->setCache($data, $scriptProperties);\\n    }\\n}\\n\\n$output = implode($outputSeparator, $data);\\n$output = $pdoFetch->getChunk($tplWrapper, array(\\n    \'schema\' => $sitemapSchema,\\n    \'output\' => $output,\\n    \'items\' => $output,\\n));\\n$pdoFetch->addTime(\'Rows wrapped\');\\n\\nif ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {\\n    $output .= \'<pre class=\\"pdoSitemapLog\\">\' . print_r($pdoFetch->getTime(), 1) . \'<\\/pre>\';\\n}\\n\\nif (!empty($forceXML)) {\\n    header(\\"Content-Type:text\\/xml\\");\\n    @session_write_close();\\n    exit($output);\\n} else {\\n    return $output;\\n}"}',
);